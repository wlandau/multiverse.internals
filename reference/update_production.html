<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Update production — update_production • multiverse.internals</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Update production — update_production"><meta name="description" content="Update the production universe."><meta property="og:description" content="Update the production universe."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multiverse.internals</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-multiverse/multiverse.internals/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Update production</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-multiverse/multiverse.internals/blob/main/R/update_production.R" class="external-link"><code>R/update_production.R</code></a></small>
      <div class="d-none name"><code>update_production.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Update the production universe.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">update_production</span><span class="op">(</span></span>
<span>  <span class="va">path_production</span>,</span>
<span>  <span class="va">path_community</span>,</span>
<span>  repo_production <span class="op">=</span> <span class="st">"https://production.r-multiverse.org"</span>,</span>
<span>  repo_community <span class="op">=</span> <span class="st">"https://community.r-multiverse.org"</span>,</span>
<span>  days_notice <span class="op">=</span> <span class="fl">28L</span>,</span>
<span>  mock <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-path-production">path_production<a class="anchor" aria-label="anchor" href="#arg-path-production"></a></dt>
<dd><p>Character string, directory path to the source
files of the production universe.</p></dd>


<dt id="arg-path-community">path_community<a class="anchor" aria-label="anchor" href="#arg-path-community"></a></dt>
<dd><p>Character string, directory path to the source
files of the community universe.</p></dd>


<dt id="arg-repo-production">repo_production<a class="anchor" aria-label="anchor" href="#arg-repo-production"></a></dt>
<dd><p>Character string, URL of the production universe.</p></dd>


<dt id="arg-repo-community">repo_community<a class="anchor" aria-label="anchor" href="#arg-repo-community"></a></dt>
<dd><p>Character string, URL of the community universe.</p></dd>


<dt id="arg-days-notice">days_notice<a class="anchor" aria-label="anchor" href="#arg-days-notice"></a></dt>
<dd><p>Integer scalar, number of days between the
detection of a production issue and removal from the production universe.</p></dd>


<dt id="arg-mock">mock<a class="anchor" aria-label="anchor" href="#arg-mock"></a></dt>
<dd><p>For testing purposes only, a named list of data frames
for inputs to various intermediate functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>NULL</code> (invisibly)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>update_production()</code> controls how packages enter and leave
the production universe. It updates the production <code>packages.json</code>
manifest depending on the contents of the community
universe and issues with package checks. There are 3 phases:</p><ol><li><p>Demote packages: packages with any check issues in production
are given <code>days_notice</code> days to fix the problems. If the problems
are fixed on time, then the package stays in
production, and the notice period resets (the next problem is given
the full <code>days_notice</code> notice period from scratch). Otherwise,
if there are still issues after <code>days_notice</code> days, then the package
is removed from the <code>packages.json</code> manifest and added to a special
<code>removing.json</code> manifest in production. <code>removing.json</code> ensures
that the builds are actually removed from production before the
package can be promoted again. That way, if the next automatic
promotion fails production checks, no build will be available
to install from <a href="https://production.r-multiverse.org" class="external-link">https://production.r-multiverse.org</a>.</p></li>
<li><p>Clear removals: a demoted package stays in <code>removing.json</code> until
the builds are removed from <a href="https://production.r-multiverse.org" class="external-link">https://production.r-multiverse.org</a>.
After the builds are gone, the package is removed from <code>removing.json</code>
so it can be promoted again. No build will become available again
until the package passes all production checks.</p></li>
<li><p>Promote packages: a package in the community universe is moved
to production if:</p><ul><li><p>It passes description checks from <code><a href="issues_descriptions.html">issues_descriptions()</a></code>.</p></li>
<li><p>It passes version checks from <code><a href="issues_versions.html">issues_versions()</a></code>.</p></li>
<li><p>The package is available to install from
<a href="https://community.r-multiverse.org" class="external-link">https://community.r-multiverse.org</a>.</p></li>
<li><p>The package is not in <code>removing.json</code>.
To promote the package, an entry is created in the production
<code>packages.json</code> with the Git hash of the latest release.</p></li>
</ul></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">url_production</span> <span class="op">=</span> <span class="st">"https://github.com/r-multiverse/production"</span></span></span>
<span class="r-in"><span><span class="va">url_community</span> <span class="op">=</span> <span class="st">"https://github.com/r-multiverse/community"</span></span></span>
<span class="r-in"><span><span class="va">path_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">path_community</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gert</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/gert/reference/git_fetch.html" class="external-link">git_clone</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url_production</span>, path <span class="op">=</span> <span class="va">path_production</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gert</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/gert/reference/git_fetch.html" class="external-link">git_clone</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url_community</span>, path <span class="op">=</span> <span class="va">path_community</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">update_production</span><span class="op">(</span></span></span>
<span class="r-in"><span>  repo_production <span class="op">=</span> <span class="st">"https://production.r-multiverse.org"</span>,</span></span>
<span class="r-in"><span>  repo_community <span class="op">=</span> <span class="st">"https://community.r-multiverse.org"</span>,</span></span>
<span class="r-in"><span>  path_production <span class="op">=</span> <span class="va">path_production</span>,</span></span>
<span class="r-in"><span>  path_community <span class="op">=</span> <span class="va">path_community</span>,</span></span>
<span class="r-in"><span>  days_notice <span class="op">=</span> <span class="fl">28L</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Charlie Gao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

